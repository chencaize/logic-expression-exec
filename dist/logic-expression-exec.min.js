!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self)["logic-expression-exec"]=e()}(this,(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,s(r.key),r)}}function i(t,e,i){return(e=s(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function r(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,a(t,e,"get"))}function n(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,a(t,e,"set"),i),i}function a(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function h(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}var o=new WeakMap,l=new WeakMap,E=new WeakMap,u=new WeakMap,S=new WeakMap,c=new WeakMap,p=new WeakMap,f=new WeakMap,T=new WeakMap,R=new WeakMap,v=new WeakMap,P=function(){function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,s),h(this,o,{writable:!0,value:{expression:"",parseExpression:void 0,parseExpressionProps:void 0,appendProps:void 0}}),h(this,l,{writable:!0,value:{and:"&&",or:"||",bracketLeft:"(",bracketRight:")"}}),h(this,E,{writable:!0,value:{expressionArraySpliter:"(&&||||(|))",expressionArray:[],expressionBracketInfo:{}}}),h(this,u,{writable:!0,value:void 0}),i(this,"EXCLUSIVEOR",65535),i(this,"EXPRESSION_SET",1),i(this,"PARSEEXPRESSION_SET",2),i(this,"PARSEEXPRESSIONPROPS_SET",4),i(this,"APPENDPROPS_SET",8),i(this,"AND_SET",16),i(this,"OR_SET",32),i(this,"BRACKETLEFT_SET",64),i(this,"BRACKETRIGHT_SET",128),i(this,"EXPRESSIONARRAY_SET",256),i(this,"EXPRESSIONBRACKETINFO_SET",512),i(this,"EXPRESSIONARRAYSPLITER_SET",1024),i(this,"INIT_SET",this.AND_SET|this.OR_SET|this.BRACKETLEFT_SET|this.BRACKETRIGHT_SET|this.EXPRESSIONARRAYSPLITER_SET),i(this,"SET_SUCCESS",this.EXPRESSION_SET|this.PARSEEXPRESSION_SET|this.AND_SET|this.OR_SET|this.BRACKETLEFT_SET|this.BRACKETRIGHT_SET|this.EXPRESSIONARRAY_SET|this.EXPRESSIONBRACKETINFO_SET|this.EXPRESSIONARRAYSPLITER_SET),h(this,S,{writable:!0,value:function(t){return""===t||!t&&0!==t&&""!==t}}),h(this,c,{writable:!0,value:function(t,e){return 0==((e^t)&t)}}),h(this,p,{writable:!0,value:function(t){return t.replaceAll(/ +/gi,"")}}),h(this,f,{writable:!0,value:function(t){var e="";return e+="(",Object.keys(t).forEach((function(i){t[i].split("").forEach((function(t){e+="\\",e+=t})),e+="|"})),e=e.slice(0,-1),e+=")"}}),h(this,T,{writable:!0,value:function(t,e){return t.split(new RegExp(e,"gi")).filter((function(t){return""!=t}))}}),h(this,R,{writable:!0,value:function(t,e){for(var i={},s=[],r=0;r<t.length;r++)if(t[r]==e.bracketLeft)s.push(r);else if(t[r]==e.bracketRight){var n=s.pop();if(null==n){i=!1;break}i[n]=r}return 0!=s.length&&(i=!1),i}}),h(this,v,{writable:!0,value:function(t,e,i,s,r){return function n(a,h){for(var o=[],l=a;l<=h;l++){var E=t[l];switch(E){case s.bracketLeft:o.push(n(l+1,e[l]-1)),l=e[l];break;case s.bracketLeft:break;default:if(E==s.or){for(var u=!0,S=void 0;null!=(S=o.shift())&&u>0;)u=u&&i(S,r);if(o=[],u>0)return u}else{if(E==s.and)continue;o.push(E)}}}if(0!=o.length){for(var c,p=!0;null!=(c=o.shift())&&p>0;)p=p&&i(c,r);return p}return-1}(0,t.length-1)}}),n(this,u,this.INIT_SET),this.update(e,r)}var a,P,b;return a=s,P=[{key:"getBasic",value:function(t){return r(this,o)[t]}},{key:"getOperator",value:function(t){return r(this,l)[t]}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.expression,s=t.parseExpression,a=t.parseExpressionProps,h=t.appendProps,c=e.and,v=e.or,P=e.bracketLeft,b=e.bracketRight,A=!1;r(this,S).call(this,i)||(r(this,o).expression=r(this,p).call(this,i),n(this,u,r(this,u)|this.EXPRESSION_SET),A=!0),!r(this,S).call(this,s)&&s instanceof Function&&(r(this,o).parseExpression=s,n(this,u,r(this,u)|this.PARSEEXPRESSION_SET)),r(this,S).call(this,a)||(r(this,o).parseExpressionProps=a,n(this,u,r(this,u)|this.PARSEEXPRESSIONPROPS_SET)),r(this,S).call(this,h)||(r(this,o).appendProps=h,n(this,u,r(this,u)|this.APPENDPROPS_SET)),r(this,S).call(this,c)||(r(this,l).and=c,n(this,u,r(this,u)|this.AND_SET),A=!0),r(this,S).call(this,v)||(r(this,l).or=v,n(this,u,r(this,u)|this.OR_SET),A=!0),r(this,S).call(this,P)||(r(this,l).bracketLeft=P,n(this,u,r(this,u)|this.BRACKETLEFT_SET),A=!0),r(this,S).call(this,b)||(r(this,l).bracketRight=b,n(this,u,r(this,u)|this.BRACKETRIGHT_SET),A=!0),A&&(r(this,E).expressionArraySpliter=r(this,f).call(this,r(this,l)),n(this,u,r(this,u)|this.EXPRESSIONARRAYSPLITER_SET),r(this,E).expressionArray=r(this,T).call(this,r(this,o).expression,r(this,E).expressionArraySpliter),n(this,u,r(this,u)|this.EXPRESSIONARRAY_SET),r(this,E).expressionBracketInfo=r(this,R).call(this,r(this,E).expressionArray,r(this,l)),0==r(this,E).expressionBracketInfo?n(this,u,r(this,u)&(this.EXPRESSIONBRACKETINFO_SET^this.EXCLUSIVEOR)):n(this,u,r(this,u)|this.EXPRESSIONBRACKETINFO_SET))}},{key:"exec",value:function(){if(!r(this,c).call(this,this.SET_SUCCESS,r(this,u)))return console.error("Config is not right!Please check!"),-1;var t=-1;try{t=r(this,v).call(this,r(this,E).expressionArray,r(this,E).expressionBracketInfo,r(this,o).parseExpression,r(this,l),r(this,o).parseExpressionProps)}catch(t){console.error("Handle failed!",t)}return-1==t&&console.warn("Config may be not right!"),t}}],P&&e(a.prototype,P),b&&e(a,b),Object.defineProperty(a,"prototype",{writable:!1}),s}();return P}));
